import{j as Q}from"./jsx-runtime-FsUICBgo.js";import{r as s}from"./index-RfLt4OUa.js";import{i as Be}from"./index-zZCSeRuV.js";import{p as C}from"./index-4QtD-hFu.js";import{I as xe}from"./preview-errors-Ix78kkVy.js";import{v as Le}from"./v4-yQnnJER4.js";function Y(t){const e=s.useRef();return Be(t,e.current)||(e.current=t),e.current}function $e(t,e){return s.useMemo(t,Y(e))}function Ie(t,e){return s.useCallback(t,Y(e))}function F(t,e){s.useEffect(t,Y(e))}function k(t){if(t&&t.returnFields){const{returnFields:e,...r}=t;return console.warn('"returnFields" has been renamed to "_return". Support for "returnFields" will be removed in the next major release'),{...r,_return:e}}return t}const Me=(t,e)=>{switch(e.type){case"FETCH_REQUEST":return{...t,isLoading:!0,isError:!1,error:null};case"FETCH_SUCCESS":return{...t,isLoading:!1,isError:!1,error:null,data:e.payload};case"FETCH_FAILURE":return{...t,isLoading:!1,isError:!0,error:e.error||null};default:throw new Error}},$=(t,e,r,n,o)=>{const a=s.useRef(!1),l=s.useRef(0),[c,i]=s.useState({trigger:!1,callback:void 0}),[u,d]=s.useState(t),[g,m]=s.useReducer(Me,{isLoading:!1,isError:!1,data:n,error:null}),_=b=>{m({type:"FETCH_SUCCESS",payload:b})},y=s.useCallback(async(b,O,w,M=!0)=>{m({type:"FETCH_REQUEST"});try{const{result:R}=await e.call(r,b);if(!a.current&&O===l.current){let D=R;o&&(D=o(R)),M&&m({type:"FETCH_SUCCESS",payload:D}),w&&w(D)}}catch(R){a.current||m({type:"FETCH_FAILURE",error:R})}},[r,e,o]);return s.useEffect(()=>()=>{a.current=!0},[]),s.useEffect(()=>{c.trigger&&(l.current++,y(u,l.current,c.callback,c.storeResult),i({trigger:!1,callback:void 0}))},[c,y,u]),{state:g,parameters:u,setParameters:d,setData:_,setFetchToken:i}},He=(t,e)=>{const{state:r,setData:n,setFetchToken:o}=$(t,e.listFields,e),a=s.useCallback(()=>o({trigger:!0}),[o]);return[r,{fetchFields:a,setFieldsResponse:n}]},Ne=(t,e,r)=>{const{state:n,parameters:o,setParameters:a,setData:l,setFetchToken:c}=$(k(t),e.query,e,r),i=s.useCallback(d=>{a(typeof d=="function"?g=>k(d(g)):k(d))},[a]),u=s.useCallback(d=>c({trigger:!0,callback:d}),[c]);return[{...n,parameters:o},{setSearchParameters:i,setSearchResponse:l,performSearch:u}]},We=(t,e,r)=>{const{state:n,parameters:o,setParameters:a,setData:l,setFetchToken:c}=$(t,e.query,e,r,d=>d.aggregations||[]),i=s.useCallback((d,g)=>{a(d),c({trigger:!0,callback:g})},[c,a]),u=s.useCallback((d,g)=>{a(d),c({trigger:!0,callback:g,storeResult:!1})},[c,a]);return[{...n,parameters:o},{setGlobalAggregationParameters:a,setGlobalAggregationsResponse:l,fetchGlobalAggregations:i,fetchGlobalAggregationsWithoutStoring:u}]},je=(t,e)=>{const{state:r,setParameters:n,setFetchToken:o}=$(t,e.query,e),a=s.useCallback((l,c,i)=>{n(u=>({...u,filter:l,collectionIds:c})),o({trigger:!0,callback:i})},[n,o]);return[r,{fetchDocuments:a}]},qe=(t,e,r)=>{const{state:n,parameters:o,setParameters:a,setData:l,setFetchToken:c}=$(t,e.getAutocompletion,e,r),i=s.useCallback(u=>{a(u),c({trigger:!0})},[a,c]);return[{...n,parameters:o},{setAutocompletions:l,fetchAutocompletions:i}]};var v={},q={};Object.defineProperty(q,"__esModule",{value:!0});var Ge=s,U=Ue(Ge);function Ue(t){return t&&t.__esModule?t:{default:t}}var Qe=function(e,r){return e.toString()+`

This is located at:`+r},ue=function(e){var r=e.componentStack,n=e.error;return U.default.createElement("div",{style:Ve,title:Qe(n,r)},U.default.createElement("svg",{style:ze,viewBox:"0 0 24 24",preserveAspectRatio:"xMidYMid"},U.default.createElement("path",{d:`M20,12A8,8 0 0,0 12,4A8,8 0 0,0 4,12A8,8 0 0,0 12,20A8,8 0 0,0 20,
        12M22,12A10,10 0 0,1 12,22A10,10 0 0,1 2,12A10,10 0 0,1 12,2A10,10 0 0,1 22,
        12M15.5,8C16.3,8 17,8.7 17,9.5C17,10.3 16.3,11 15.5,11C14.7,11 14,10.3 14,
        9.5C14,8.7 14.7,8 15.5,8M10,9.5C10,10.3 9.3,11 8.5,11C7.7,11 7,10.3 7,9.5C7,
        8.7 7.7,8 8.5,8C9.3,8 10,8.7 10,9.5M12,14C13.75,14 15.29,14.72 16.19,
        15.81L14.77,17.23C14.32,16.5 13.25,16 12,16C10.75,16 9.68,16.5 9.23,
        17.23L7.81,15.81C8.71,14.72 10.25,14 12,14Z`})))};ue.propTypes={componentStack:C.string.isRequired,error:typeof Error=="function"?C.instanceOf(Error).isRequired:C.any.isRequired};var Ve={height:"100%",maxHeight:"100vh",width:"100%",maxWidth:"100vw",display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",backgroundColor:"#C00",color:"#FFF",boxSizing:"border-box",cursor:"help"},ze={fill:"currentColor",flex:"1 1 auto"};q.default=ue;var I={};Object.defineProperty(I,"__esModule",{value:!0});I.withErrorBoundary=void 0;var Ke=function(){function t(e,r){for(var n=0;n<r.length;n++){var o=r[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,r,n){return r&&t(e.prototype,r),n&&t(e,n),e}}(),pe=s,V=fe(pe),Ye=q,Ze=fe(Ye);function fe(t){return t&&t.__esModule?t:{default:t}}function Je(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function ce(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:t}function Xe(t,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}var le=s.babelPluginFlowReactPropTypes_proptype_ComponentType||C.any,G=function(t){Xe(e,t);function e(){var r,n,o,a;Je(this,e);for(var l=arguments.length,c=Array(l),i=0;i<l;i++)c[i]=arguments[i];return a=(n=(o=ce(this,(r=e.__proto__||Object.getPrototypeOf(e)).call.apply(r,[this].concat(c))),o),o.state={error:null,info:null},n),ce(o,a)}return Ke(e,[{key:"componentDidCatch",value:function(n,o){var a=this.props.onError;if(typeof a=="function")try{a.call(this,n,o?o.componentStack:"")}catch{}this.setState({error:n,info:o})}},{key:"render",value:function(){var n=this.props,o=n.children,a=n.FallbackComponent,l=this.state,c=l.error,i=l.info;return c!==null?V.default.createElement(a,{componentStack:i?i.componentStack:"",error:c}):o||null}}]),e}(pe.Component);G.defaultProps={FallbackComponent:Ze.default};G.propTypes={error:typeof Error=="function"?C.instanceOf(Error):C.any,info:C.shape({componentStack:C.string.isRequired})};var et=I.withErrorBoundary=function(e,r,n){var o=function(c){return V.default.createElement(G,{FallbackComponent:r,onError:n},V.default.createElement(e,c))},a=e.displayName||e.name;return o.displayName=a?"WithErrorBoundary("+a+")":"WithErrorBoundary",o};et.propTypes=le===C.any?{}:le;I.default=G;Object.defineProperty(v,"__esModule",{value:!0});v.ErrorBoundaryFallbackComponent=he=v.withErrorBoundary=v.ErrorBoundary=void 0;var tt=q,rt=ge(tt),de=I,me=ge(de);function ge(t){return t&&t.__esModule?t:{default:t}}v.default=me.default;v.ErrorBoundary=me.default;var he=v.withErrorBoundary=de.withErrorBoundary;v.ErrorBoundaryFallbackComponent=rt.default;const z=t=>()=>Q.jsxs("div",{children:[" There was an error rendering ",t]});try{z.displayName="FallbackComponent",z.__docgenInfo={description:"",displayName:"FallbackComponent",props:{}}}catch{}const nt=(t,e)=>{console.error(t,e)},ot=nt,ye="[\\^~><:!,|()[\\]* ]",at=new RegExp(`(\\\\)?(${ye})`,"g"),st=new RegExp(`(\\\\${ye})`,"g");function L(t){return(t||"").replace(at,(e,r,n)=>r?e:`\\${n}`)}function Ot(t){return(t||"").replace(st,e=>e.substr(1,1))}const ct=t=>"["+t.map(({type:r,count:n,name:o,field:a,aggregations:l,match:c,path:i})=>{if(r==="term"&&a){const d=L(a),g=n?",count:"+n:"",m=o?",name:"+o:"",_=`term(${d}${g}${m})`;if(a.includes("enriched_")&&a.includes("entities.text")){const y=L(a.split(".")[0]),b=L(a.slice(0,a.lastIndexOf("."))),O=`.term(${y}.entities.type,count:1)`;return`nested(${b}).${_}${O}`}return _}let u="";if(l&&l[0]){u+="nested(";const d=L(i||l[0].field||""),g=c||l[0].match;u=u+d+").filter("+g+")";let m;l[0].aggregations?m=l[0].aggregations[0]:m=l[0];const _=m.count?",count:"+m.count:"",y=m.name?",name:"+m.name:"";u=u+".term("+L(m.field||"")+_+y+")"}return u}).toString()+"]",wt=t=>t[0].key!==void 0,lt=t=>{const{field:e,path:r,match:n}=t[0]||{};return e!==void 0||r!==void 0||n!==void 0},K={document:null,element:null,elementType:null},it={performSearch:()=>Promise.resolve(),fetchAutocompletions:()=>Promise.resolve(),fetchAggregations:()=>Promise.resolve(),fetchComponentSettings:()=>Promise.resolve(),fetchDocuments:()=>{},setSelectedResult:()=>{},setAutocompletionOptions:()=>{},setSearchParameters:()=>{},setIsResultsPaginationComponentHidden:()=>{},fetchFields:()=>Promise.resolve()},ut={parameters:{projectId:""},data:null,isLoading:!1,isError:!1,error:null},Ee={count:0,filter:"",passages:{enabled:!1},tableResults:{enabled:!1}},Se={parameters:{projectId:"",...Ee},data:null,isLoading:!1,isError:!1,error:null},_e={parameters:{projectId:"",_return:[],aggregation:"",passages:{enabled:!1},tableResults:{enabled:!1}},data:null,isLoading:!1,isError:!1,error:null},pt={parameters:{projectId:"",prefix:""},data:null,isLoading:!1,isError:!1,error:null},ft={parameters:{projectId:""},data:null,isLoading:!1,isError:!1,error:null},dt={searchResponseStore:ut,globalAggregationsResponseStore:Se,fetchDocumentsResponseStore:_e,selectedResult:K,autocompletionStore:pt,isResultsPaginationComponentHidden:!1,fieldsStore:ft},mt=s.createContext(it),gt=s.createContext(dt),ht=({searchClient:t,projectId:e,documentProvider:r,overrideAggregationResults:n,overrideSearchResults:o,overrideQueryParameters:a,overrideSelectedResult:l=K,overrideAutocompletionResults:c,overrideCollectionsResults:i,overrideComponentSettings:u,children:d})=>{const[g,m]=s.useState(null),[_,y]=s.useState(i),[b,O]=s.useState({}),[w,M]=s.useState(l),[R,D]=s.useState(u),[Z,Ae]=s.useState(),[J,{setSearchResponse:H,setSearchParameters:T,performSearch:X}]=Ne({projectId:e,...k(a)},t,o),[N,{setGlobalAggregationsResponse:Ce,fetchGlobalAggregations:ee,fetchGlobalAggregationsWithoutStoring:W}]=We({...Se.parameters,projectId:e},t,n),P=s.useCallback(async(h,f)=>{if(lt(h)){const p=ct(h),E={...f,aggregation:p};ee(E)}},[ee]),Fe=s.useCallback(async(h,f=!0)=>{let p=!1;const E=k(h);T(E),f&&E.filter!==""&&(p=!0,W({...E,...Ee,filter:""},async S=>{P(S,E)})),X(async S=>{!p&&f&&S&&S.aggregations&&P(S.aggregations,E)})},[W,P,X,T]),[te,{fetchAutocompletions:ve,setAutocompletions:re}]=qe({projectId:e,count:b.completionsCount,prefix:""},t,c);F(()=>{m(N.data)},[N.data]),F(()=>{H(o)},[o]),F(()=>{T(h=>({...h,projectId:e,...k(a)}))},[e,a]),F(()=>{Ce(n)},[n]),F(()=>{y(i)},[i]),F(()=>{M(l)},[l]),F(()=>{re(c)},[c]),F(()=>{D(u)},[u]),s.useEffect(()=>{async function h(){try{const{result:p}=await t.listCollections({projectId:e});y(p)}catch(p){console.error("Error fetching collections",p)}}async function f(){try{const{result:p}=await t.getComponentSettings({projectId:e});D(p)}catch(p){console.error("Error fetching component settings",p)}}h(),f()},[t,e]);const Re=Ie(async h=>{const{splitSearchQuerySelector:f,updateAutocompletions:p,completionsCount:E,minCharsToAutocomplete:S}=b;if(p&&E&&f&&S!==void 0){const B=h.split(f),A=B[B.length-1],x={projectId:e,prefix:A,count:E};if(A){ve(x);return}re(void 0)}},[b,e]),ke=s.useCallback(async h=>{const f=k(h);T(p=>({...p,filter:""})),W(f,async p=>{P(p,f)})},[W,P,T]),De=h=>{const f=h.document?h:K;!f.element&&f.elementType&&(f.elementType=null),!f.elementType&&f.element&&(f.element=null),M(f)},[ne,{fetchDocuments:oe}]=je({..._e.parameters,projectId:e},t),Te=s.useCallback((h,f,p)=>{oe(h,f||[],E=>{if(p&&p.results&&E.results){const S=[...p.results],B=[...E.results];for(;B.length;){const A=B.pop();if(!A)continue;const x=S.findIndex(j=>j.document_id===(A==null?void 0:A.document_id)&&j.result_metadata.collection_id===A.result_metadata.collection_id);if(x!==-1){const j={...S[x],...A};S.splice(x,1,j)}else S.push(A)}H({...p,matching_results:S.length,results:S})}else p||H(E)})},[oe,H]),[ae,{fetchFields:se}]=He({projectId:e},t),Oe=s.useCallback(()=>{se()},[se]),we={performSearch:Fe,fetchAggregations:ke,fetchAutocompletions:Re,fetchDocuments:Te,setSelectedResult:De,setAutocompletionOptions:O,setSearchParameters:T,setIsResultsPaginationComponentHidden:Ae,fetchFields:Oe},Pe=$e(()=>({aggregationResults:g,autocompletionStore:te,fetchDocumentsResponseStore:ne,searchResponseStore:J,globalAggregationsResponseStore:N,selectedResult:w,collectionsResults:_,componentSettings:R,isResultsPaginationComponentHidden:Z,fieldsStore:ae,documentProvider:r}),[g,te,ne,J,N,w,_,R,Z,ae,r]);return Q.jsx(mt.Provider,{value:we,children:Q.jsx(gt.Provider,{value:Pe,children:d})})},Pt=he(ht,z("DiscoverySearch"),ot),{addons:yt}=__STORYBOOK_MODULE_PREVIEW_API__,{global:ie}=__STORYBOOK_MODULE_GLOBAL__;var Et="storybook/actions",St=`${Et}/action-event`,_t={depth:10,clearOnStoryChange:!0,limit:50},be=(t,e)=>{let r=Object.getPrototypeOf(t);return!r||e(r)?r:be(r,e)},bt=t=>!!(typeof t=="object"&&t&&be(t,e=>/^Synthetic(?:Base)?Event$/.test(e.constructor.name))&&typeof t.persist=="function"),At=t=>{if(bt(t)){let e=Object.create(t.constructor.prototype,Object.getOwnPropertyDescriptors(t));e.persist();let r=Object.getOwnPropertyDescriptor(e,"view"),n=r==null?void 0:r.value;return typeof n=="object"&&(n==null?void 0:n.constructor.name)==="Window"&&Object.defineProperty(e,"view",{...r,value:Object.create(n.constructor.prototype)}),e}return t},Ct=()=>typeof crypto=="object"&&typeof crypto.getRandomValues=="function"?Le():Date.now().toString(36)+Math.random().toString(36).substring(2);function Bt(t,e={}){let r={..._t,...e},n=function(...o){var g,m;if(e.implicit){let _=(g="__STORYBOOK_PREVIEW__"in ie?ie.__STORYBOOK_PREVIEW__:void 0)==null?void 0:g.storyRenders.find(y=>y.phase==="playing"||y.phase==="rendering");if(_){let y=!((m=window==null?void 0:window.FEATURES)!=null&&m.disallowImplicitActionsInRenderV8),b=new xe({phase:_.phase,name:t,deprecated:y});if(y)console.warn(b);else throw b}}let a=yt.getChannel(),l=Ct(),c=5,i=o.map(At),u=o.length>1?i:i[0],d={id:l,count:0,data:{name:t,args:u},options:{...r,maxDepth:c+(r.depth||3),allowFunction:r.allowFunction||!1}};a.emit(St,d)};return n.isAction=!0,n}export{Pt as D,z as F,gt as S,Bt as a,mt as b,F as c,Ot as d,L as e,wt as i,ot as o,Ie as u,he as w};
